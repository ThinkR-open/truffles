---
title: "flat_get_info_chene_truffe.Rmd empty"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r development, include=FALSE}
library(testthat)
```

```{r development-load}
# Load already included functions if relevant
pkgload::load_all(export_all = FALSE)
```

# get_info_chene_truffe

```{r function-get_info_chene_truffe}
#' get_info_chene_truffe Title
#'
#' @param dbtruffe dbtruffe TOCOMPLETE
#' @param idchene idchene TOCOMPLETE
#'
#' @return a list
#' @importFrom dplyr filter summarise pull
#' @export
#'
#' @examples
get_info_chene_truffe <- function(dbtruffe, idchene) {
  
truffe_chene <- dbtruffe |>
      filter(id_chene == idchene) 

if (nrow(truffe_chene) == 0) {
  return(list(poids_tot = 0,
            derniere_truffe = "-"))
}
  
poids_tot = truffe_chene |>
  summarise(poids_tot = sum(poids, na.rm = TRUE)) |> 
  pull(poids_tot)

derniere_truffe <- truffe_chene |>
  summarise(date_trouve = as.Date(max(date_trouve, na.rm = TRUE)))|> 
  pull(date_trouve)

return(list(poids_tot = poids_tot,
            derniere_truffe = derniere_truffe))


}
```

```{r examples-get_info_chene_truffe}
conn <- connect_db()
truffe <- DBI::dbReadTable(conn, name = "truffe")

get_info_chene_truffe(dbtruffe = truffe, idchene = "chene162")
DBI::dbDisconnect(conn)
```

```{r tests-get_info_chene_truffe}
test_that("get_info_chene_truffe works", {

})
```



# get_info_chene
    
```{r function-get_info_chene}
#' Title
#' 
#' Description
#'
#' @param dbchene dbchene TOCOMPLETE
#' @param idchene idchene TOCOMPLETE
#' 
#'
#' @importFrom dplyr filter 
#' @return a list
#' 
#' @export
get_info_chene <- function(dbchene, idchene){
    
  chene <- dbchene |>
      filter(id == idchene) 
    
    return(list(type = chene$type,
            date_plantation = as.Date(chene$date_plantation)))


}
```
  
```{r example-get_info_chene}
conn <- DBI::dbConnect(RSQLite::SQLite(), system.file("chenes_truffe.sqlite", package = "truffles"))
chene <- DBI::dbReadTable(conn, name = "chenes_feularde")

get_info_chene(dbchene = chene, idchene = "chenes162")
DBI::dbDisconnect(conn)


```
  
```{r tests-get_info_chene}
test_that("get_info_chene works", {
  expect_true(inherits(get_info_chene, "function")) 
})
```
  

# truffles_by_year
    
```{r function-truffles_by_year}
#' Title
#' 
#' Description
#' 
#' @param truffles database
#'
#' @return a dataframe
#' @importFrom dplyr mutate group_by summarise
#' @importFrom lubridate year
#' @export
truffles_by_year <- function(truffles) {
  truffles |> 
    mutate(annee = year(as.Date(date_trouve))) |>  
    group_by(annee) |> 
    summarise(poids = sum(poids))
}
```
  
```{r example-truffles_by_year}
conn <- connect_db()
truffes <- DBI::dbReadTable(conn, name = "truffe")

truffles_by_year(truffes)
```
  
```{r tests-truffles_by_year}
test_that("truffles_by_year works", {
  expect_true(inherits(truffles_by_year, "function")) 
})
```
  


```{r development-inflate, eval=FALSE}
# Run but keep eval=FALSE to avoid infinite loop
# Execute in the console directly
fusen::inflate(flat_file = "dev/flat_get_info_chene_truffe.Rmd", check = FALSE, vignette_name = NA)
grkstyle::grk_style_pkg()
```
